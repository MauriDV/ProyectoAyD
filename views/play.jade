

extends layout

block content

  h1
      //informacion de la partida
      p Puntos de #{juego.player1.getName()}: #{juego.score[0]}
      p Puntos de #{juego.player2.getName()}: #{juego.score[1]}

  .container
    if juego.score[0] >= 15 
      h1 SE TERMINO LA PARTIDA
      p ganador: #{p1}
      a(href="/") Home
    else if juego.score[1] >= 15
      h1 SE TERMINO LA PARTIDA
      p ganador: #{p2}
      a(href="/") Home
    else
      if juego.currentRound.status == "stop"
        h1 SE TERMINO LA MANO
        a(href="/newRound") Proxima Ronda
      else
        //lugar que va a representar la mesa (cartas jugadas)
        .mesa
          h1
            each i in juego.currentRound.cartasJugadas()
              h3 #{i.show()}
        // muestro las cartas que tiene disponible un jugador
        if juego.player2.name == null
          h1 Esperando oponente
        //cartas jugador 1
        if juego.player1 == juego.currentRound.currentTurn && us == p1
          h1 Turno de: #{juego.player1.getName()}
          if juego.currentRound.currentTurn.card1 !== null
            p #1   #{juego.player1.card1.show()}
          if juego.player1.card2 !== null
            p #2   #{juego.player1.card2.show()}
          if juego.player1.card3 !== null
            p #3   #{juego.player1.card3.show()}
          //puntos del envido jugado1
          p Puntos del envido: #{juego.player1.pointsCards}
        else
          h1 Cartas disponibles
          if juego.player2.card1 !== null
            p #1   #{juego.player2.card1.show()}
          if juego.player2.card2 !== null
            p #2   #{juego.player2.card2.show()}
          if juego.player2.card3 !== null
            p #3   #{juego.player2.card3.show()}
          p Puntos del envido: #{juego.player2.pointsCards}
        if juego.player1 == juego.currentRound.currentTurn && us == p1
          h1 Tu turno, posibles jugadas
          form(role='form', action="/play",method="post")
            input(type="hidden", name="idPartida", value="#{juego._id}")
            // si envido es un estado posible, entonces se mostrara.
            // si quiero es un estado posible, entonces se mostrara.
            // si no-quiero es un estado posible, entonces se mostrara.
            // si truco es un estado posible, entonces se mostrara.
            // si EnvidoEnvido es un estado posible, entonces se mostrara.
            #{a = juego.currentRound.posiblesStates()}
            each item in a
              if item == "playCard"
                if juego.currentRound.currentTurn.card1 !== null
                  input#carta1(type="submit", name="action", value="Jugar Carta #1")
                if juego.currentRound.currentTurn.card2 !== null
                  input#carta2(type="submit", name="action", value="Jugar Carta #2")
                if juego.currentRound.currentTurn.card3 !== null
                  input#carta3(type="submit", name="action", value="Jugar Carta #3")
              else
                if item == "truco"
                  if juego.currentRound.esTruco !== true
                    input#truco(type="submit", name="action", value="#{item}")
                else
                  input#jugada(type="submit", name="action", value="#{item}")
            &nbsp;
        //cartas jugador 2
        if juego.player2 == juego.currentRound.currentTurn && us == p2
          h1 Turno de: #{juego.player2.getName()}
          if juego.currentRound.currentTurn.card1 !== null
            p #1   #{juego.player2.card1.show()}
          if juego.currentRound.currentTurn.card2 !== null
            p #2   #{juego.player2.card2.show()}
          if juego.currentRound.currentTurn.card3 !== null  
            p #3   #{juego.player2.card3.show()}
          //puntos del envido jugador 2
          p Puntos del envido: #{juego.player2.pointsCards}
          h2 Posibles jugadas
          form(role='form', action="/play",method="post")
            input(type="hidden", name="idPartida", value="#{juego._id}")
            // si envido es un estado posible, entonces se mostrara.
            // si quiero es un estado posible, entonces se mostrara.
            // si no-quiero es un estado posible, entonces se mostrara.
            // si truco es un estado posible, entonces se mostrara.
            // si EnvidoEnvido es un estado posible, entonces se mostrara.
            #{a = juego.currentRound.posiblesStates()}
            each item in a
              if item == "playCard"
                if juego.currentRound.currentTurn.card1 !== null
                  input#carta1(type="submit", name="action", value="Jugar Carta #1")
                if juego.currentRound.currentTurn.card2 !== null
                  input#carta2(type="submit", name="action", value="Jugar Carta #2")
                if juego.currentRound.currentTurn.card3 !== null
                  input#carta3(type="submit", name="action", value="Jugar Carta #3")
              else
                if item == "truco"
                  if juego.currentRound.esTruco !== true
                    input#truco(type="submit", name="action", value="#{item}")
                else
                  input#jugada(type="submit", name="action", value="#{item}")
            &nbsp;
  script(src='https://cdn.socket.io/socket.io-1.4.5.js')
  script(src='http://code.jquery.com/jquery-1.11.1.js')
  script.
    var socket = io();
    $('#carta1').click(function(){
      socket.emit('chat message', $("#carta1").val());
    });

    $('#carta2').click(function(){
      socket.emit('chat message', $("#carta2").val());
    });

    $('#carta3').click(function(){
      socket.emit('chat message', $("#carta3").val());
    });

    $('#truco').click(function(){
      socket.emit('chat message', $("#truco").val());
    });

    $('#jugada').click(function(){
      socket.emit('chat message', $("#jugada").val());
    });

    socket.on('chat message', function(msg){
      location.reload();
    });
